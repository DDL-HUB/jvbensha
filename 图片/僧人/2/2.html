<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>僧人2</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: #000;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            user-select: none;
        }
        .container {
            position: relative;
            max-width: 100%;
            max-height: 100vh;
        }
        img {
            max-width: 100vw;
            max-height: 100vh;
            object-fit: contain;
            display: block;
        }
        .choice-buttons {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .choice-buttons.show {
            display: block;
        }
        .btn {
            position: absolute;
            background: transparent;
            border: none;
            cursor: pointer;
        }
        .btn-left {
            width: 45%;
            height: 20%;
            left: 3%;
            top: 55%;
        }
        .btn-right {
            width: 45%;
            height: 20%;
            right: 3%;
            top: 55%;
        }
    </style>
</head>
<body>
    <!-- 仅新增：音频元素，预加载无延迟 -->
    <audio id="clickSound" preload="auto">
        <source src="mixkit-handgun-click-1660.mp3" type="audio/mpeg">
    </audio>

    <div class="container">
        <img id="slide" src="微信图片.png" alt="僧人2">
        <div id="choiceButtons" class="choice-buttons">
            <button class="btn btn-left" onclick="choose(1)"></button>
            <button class="btn btn-right" onclick="choose(2)"></button>
        </div>
    </div>

    <script>
        const mainLine = [
	    "微信图片.png",
            "寺庙外.png",
            "寺庙内1 背身.png",
            "邱明惊讶.png",
            "寺庙内2（1）.png",
            "寺庙内2（2）.png",
            "寺庙内2（3）.png",
            "寺庙内2（4）.png",
            "寺庙内2（5）.png",
            "寺庙内2（6）.png",
            "邱明独白.png",
            "Frame 2.png",
            "任务.png",
            "初见老板.png",
            "小师傅.png",
            "邱明对老板讲话.png",
            "你是..._.png",
            "剧情提示选择.png"
        ];

        const afterChoice = [
            "账本.png",
            "读书文字.png",
            "讲述.png",
            "讲述1.png",
            "讲述1-1.png",
            "讲述2.png",
            "讲述3.png",
            "讲述4.png",
            "讲述5.png",
            "读书文字-1.png"
        ];

        let current = 0;
        let phase = 'main'; // main, choice, after
        let afterIndex = 0;

        const slide = document.getElementById('slide');
        const choiceButtons = document.getElementById('choiceButtons');
        // 仅新增：获取音频元素
        const clickSound = document.getElementById('clickSound');

        function updateImage(src) {
            slide.src = src;
        }

        function showChoiceButtons(show) {
            if (show) {
                choiceButtons.classList.add('show');
            } else {
                choiceButtons.classList.remove('show');
            }
        }

        // 仅修改此函数：添加音频播放，其余逻辑完全不变
        function choose(option) {
            // 播放音频+重置播放位置，避免重复点击无声音
            clickSound.currentTime = 0;
            clickSound.play();
            
            showChoiceButtons(false);
            if (option === 1) {
                updateImage("选择1.png");
            } else {
                updateImage("选择2.png");
            }
            phase = 'after';
            afterIndex = 0;
        }

        // 核心修改：在next函数中添加after阶段的结尾跳转逻辑，其余不变
        function next() {
            if (phase === 'main') {
                if (current < mainLine.length - 1) {
                    current++;
                    updateImage(mainLine[current]);
                    if (mainLine[current] === "剧情提示选择.png") {
                        phase = 'choice';
                        showChoiceButtons(true);
                    }
                }
            } else if (phase === 'choice') {
                // 等待用户点击选择按钮，不响应普通点击
                return;
            } else if (phase === 'after') {
                if (afterIndex < afterChoice.length) {
                    updateImage(afterChoice[afterIndex]);
                    afterIndex++;
                } else {
                    // 选择后剧情到最后一张，再次翻页跳转到3.html
                    window.location.href = "../3/3.html";
                }
            }
        }

        function prev() {
            if (phase === 'main') {
                if (current > 0) {
                    current--;
                    updateImage(mainLine[current]);
                }
            } else if (phase === 'after') {
                if (afterIndex > 1) {
                    afterIndex--;
                    updateImage(afterChoice[afterIndex - 1]);
                } else if (afterIndex === 1) {
                    afterIndex = 0;
                    // 回到选择画面
                    phase = 'choice';
                    updateImage("剧情提示选择.png");
                    showChoiceButtons(true);
                } else {
                    phase = 'choice';
                    updateImage("剧情提示选择.png");
                    showChoiceButtons(true);
                }
            }
        }

        function reset() {
            current = 0;
            phase = 'main';
            afterIndex = 0;
            showChoiceButtons(false);
            updateImage(mainLine[0]);
        }

        document.body.addEventListener('click', function(e) {
            if (e.target.classList.contains('btn')) return;
            next();
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowRight' || e.key === ' ') {
                next();
            } else if (e.key === 'ArrowLeft') {
                prev();
            } else if (e.key === 'Escape') {
                reset();
            }
        });
    </script>
</body>
</html>